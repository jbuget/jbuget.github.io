{{ define "main" }}
<main role="main">
    <div class="container">
        {{ $resume := resources.Get .Params.resume_file | transform.Unmarshal }}
        {{ with $resume }} {{ with .basics }}

        <h1>{{ .label }}</h1>
        <!-- En-t√™te avec informations personnelles -->
        <!-- <div class="row">
            <header class="resume-header">
                <h1 data-pagefind-meta="title">{{ .name }}</h1>
                {{ if .label }}
                <h2>{{ .label }}</h2>
                {{ end }} {{ if .summary }}
                <p class="summary">{{ .summary }}</p>
                {{ end }}

                <div class="contact-info">
                    {{ if .email }}
                    <p><a href="mailto:{{ .email }}">{{ .email }}</a></p>
                    {{ end }} {{ if .url }}
                    <p>
                        <a href="{{ .url }}" target="_blank" rel="noopener"
                            >{{ .url }}</a
                        >
                    </p>
                    {{ end }} {{ with .location }} {{ if .address }}
                    <p>{{ .address }}</p>
                    {{ end }} {{ end }}
                </div>

                {{ if .profiles }}
                <div class="social-profiles">
                    {{ range .profiles }}
                    <a
                        href="{{ .url }}"
                        target="_blank"
                        rel="noopener"
                        title="{{ .network }}"
                    >
                        {{ if eq .network "LinkedIn" }}LI{{ end }} {{ if eq
                        .network "Twitter" }}TW{{ end }} {{ if eq .network
                        "Bluesky" }}BS{{ end }} {{ if eq .network "GitHub"
                        }}GH{{ end }}
                    </a>
                    {{ end }}
                </div>
                {{ end }}
            </header>
        </div> -->
        {{ end }}

        <!-- Pr√©sentation -->
        {{ if .basics.summary }}
        <div class="row">
            <section class="resume-section presentation">
                <div class="presentation-content">
                    {{ .basics.summary | markdownify }}
                </div>
            </section>
        </div>
        {{ end }}

        <!-- Profils -->
        {{ if .basics.profiles }}
        <div class="row">
            <section class="resume-section profiles">
                <h2>Profils</h2>
                <div class="profiles-container">
                    {{ range .basics.profiles }}
                    <div class="profile">
                        {{ if .url }}
                        <a
                            href="{{ .url }}"
                            target="_blank"
                            rel="noopener"
                            class="profile-link"
                        >
                            <span class="profile-network">{{ .network }}</span>
                            {{ if .username }}
                            <span class="profile-username"
                                >{{ .username }}</span
                            >
                            {{ end }}
                        </a>
                        {{ else }}
                        <div class="profile-link">
                            <span class="profile-network">{{ .network }}</span>
                            {{ if .username }}
                            <span class="profile-username"
                                >{{ .username }}</span
                            >
                            {{ end }}
                        </div>
                        {{ end }}
                    </div>
                    {{ end }}
                </div>
            </section>
        </div>
        {{ end }}

        <!-- Exp√©rience professionnelle -->
        {{ if .work }}
        <div class="row">
            <section class="resume-section experiences">
                <h2>Exp√©rience</h2>
                {{ range .work }} {{ if .name }}
                <article class="experience">
                    <header class="experience__header">
                        <h3 class="experience__title">
                            <span class="experience__position"
                                >{{ .position }}</span
                            >
                            ¬∑ {{ if .url }}
                            <a
                                href="{{ .url }}"
                                target="_blank"
                                rel="noopener"
                                class="experience__company"
                                >{{ .name }}</a
                            >
                            {{ else }}
                            <span class="experience__company">{{ .name }}</span>
                            {{ end }}
                        </h3>
                        <div class="experience__meta">
                            <div>
                                <time
                                    class="date"
                                    data-start="{{ .startDate }}"
                                    data-end="{{ .endDate }}"
                                >
                                    {{ .startDate | dateFormat "January 2006" }}
                                    ‚Äì {{ if .endDate }}{{ .endDate | dateFormat
                                    "January 2006" }}{{ else }}Pr√©sent{{ end }}
                                    <span class="duration"></span>
                                </time>
                            </div>

                            {{ if .location }}
                            <div class="experience__location">
                                {{ .location }}
                            </div>
                            {{ end }}
                        </div>
                    </header>

                    {{ if .summary }}
                    <div class="summary-container">
                        <div class="summary">{{ .summary | markdownify }}</div>
                    </div>
                    {{ end }} {{ if .highlights }}
                    <ul class="highlights">
                        {{ range .highlights }}
                        <li>{{ . | markdownify }}</li>
                        {{ end }}
                    </ul>
                    {{ end }}
                </article>
                {{ end }} {{ end }}
            </section>
        </div>
        {{ end }}

        <!-- Formation -->
        {{ if .education }}
        <div class="row">
            <section class="resume-section education">
                <h2>Formation</h2>
                {{ range .education }}
                <article class="institution">
                    <header class="institution__header">
                        <h3 class="institution__name">{{ .institution }}</h3>
                        <div class="institution__certificate">
                            {{ .studyType }} {{ if .area }} en {{ .area }} {{
                            end}}
                        </div>
                        <time class="date">
                            {{ .startDate | dateFormat "2006" }} ‚Äì {{ .endDate |
                            dateFormat "2006" }}
                        </time>
                    </header>
                </article>
                {{ end }}
            </section>
        </div>
        {{ end }}

        <!-- Comp√©tences -->
        {{ if .skills }}
        <div class="row">
            <section class="resume-section skills">
                <h2>Comp√©tences</h2>
                <div class="skills-container">
                    <div class="skills-grid">
                        {{ range .skills }} {{ if .name }}
                        <span class="skill-tag" title="{{ .name }}"
                            >{{ .name }}</span
                        >
                        {{ end }} {{ end }}
                    </div>
                </div>
            </section>
        </div>
        {{ end }} {{ end }}

        <!-- Action buttons -->
        <div class="row">
            <div class="resume-actions">
                <button onclick="window.print()" class="btn btn-primary">
                    üñ®Ô∏è Imprimer le CV
                </button>
                <a href="/resume.pdf" class="btn btn-secondary" target="_blank">
                    üìÑ Version PDF
                </a>
            </div>
        </div>
    </div>
</main>

<script>
    function calculateDuration(startDate, endDate) {
        const start = new Date(startDate);
        const end = endDate ? new Date(endDate) : new Date();

        let years = end.getFullYear() - start.getFullYear();
        let months = end.getMonth() - start.getMonth();

        if (months < 0) {
            years--;
            months += 12;
        }

        let duration = "";
        if (years > 0) {
            duration += years === 1 ? "1 an" : `${years} ans`;
            if (months > 0) {
                duration += " ";
            }
        }
        if (months > 0) {
            duration += months === 1 ? "1 mois" : `${months} mois`;
        }

        return duration ? ` ¬∑ ${duration}` : "";
    }

    // Calculate durations on page load
    document.addEventListener("DOMContentLoaded", function () {
        const timeElements = document.querySelectorAll("time.date[data-start]");
        timeElements.forEach(function (timeElement) {
            const startDate = timeElement.getAttribute("data-start");
            const endDate = timeElement.getAttribute("data-end");
            const durationSpan = timeElement.querySelector(".duration");

            if (startDate && durationSpan) {
                const duration = calculateDuration(startDate, endDate);
                durationSpan.textContent = duration;
            }
        });
    });
</script>

{{ end }}
