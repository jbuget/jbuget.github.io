{{ define "main" }}
<main role="main">
    <div class="container">
        <h1>Curriculum vitae</h1>
        {{ with .Site.Data.resume }} {{ with .basics }}
        <!-- En-t√™te avec informations personnelles -->
        <!-- <div class="row">
            <header class="resume-header">
                <h1 data-pagefind-meta="title">{{ .name }}</h1>
                {{ if .label }}
                <h2>{{ .label }}</h2>
                {{ end }} {{ if .summary }}
                <p class="summary">{{ .summary }}</p>
                {{ end }}

                <div class="contact-info">
                    {{ if .email }}
                    <p><a href="mailto:{{ .email }}">{{ .email }}</a></p>
                    {{ end }} {{ if .url }}
                    <p>
                        <a href="{{ .url }}" target="_blank" rel="noopener"
                            >{{ .url }}</a
                        >
                    </p>
                    {{ end }} {{ with .location }} {{ if .address }}
                    <p>{{ .address }}</p>
                    {{ end }} {{ end }}
                </div>

                {{ if .profiles }}
                <div class="social-profiles">
                    {{ range .profiles }}
                    <a
                        href="{{ .url }}"
                        target="_blank"
                        rel="noopener"
                        title="{{ .network }}"
                    >
                        {{ if eq .network "LinkedIn" }}LI{{ end }} {{ if eq
                        .network "Twitter" }}TW{{ end }} {{ if eq .network
                        "Bluesky" }}BS{{ end }} {{ if eq .network "GitHub"
                        }}GH{{ end }}
                    </a>
                    {{ end }}
                </div>
                {{ end }}
            </header>
        </div> -->
        {{ end }}

        <!-- Exp√©rience professionnelle -->
        {{ if .work }}
        <div class="row">
            <section class="resume-section experiences">
                <h2>Exp√©rience</h2>
                {{ range .work }} {{ if .name }}
                <article class="experience">
                    <header class="experience__header">
                        <h3 class="experience__title">
                            <span class="experience__position"
                                >{{ .position }}</span
                            >
                            ¬∑ {{ if .url }}
                            <a
                                href="{{ .url }}"
                                target="_blank"
                                rel="noopener"
                                class="experience__company"
                                >{{ .name }}</a
                            >
                            {{ else }}
                            <span class="experience__company">{{ .name }}</span>
                            {{ end }}
                        </h3>
                        <div class="experience__meta">
                            <div>
                                <time
                                    class="date"
                                    data-start="{{ .startDate }}"
                                    data-end="{{ .endDate }}"
                                >
                                    {{ .startDate | dateFormat "January 2006" }}
                                    ‚Äì {{ if .endDate }}{{ .endDate | dateFormat
                                    "January 2006" }}{{ else }}Pr√©sent{{ end }}
                                    <span class="duration"></span>
                                </time>
                            </div>

                            {{ if .location }}
                            <div class="experience__location">
                                {{ .location }}
                            </div>
                            {{ end }}
                        </div>
                    </header>

                    {{ if .summary }}
                    <div class="summary-container">
                        <div class="summary summary-truncated">
                            {{ .summary | markdownify }}
                        </div>
                        <div class="summary summary-full" style="display: none">
                            {{ .summary | markdownify }}
                        </div>
                        <button
                            class="btn-toggle-summary"
                            onclick="toggleSummary(this)"
                        >
                            Voir plus
                        </button>
                    </div>
                    {{ end }} {{ if .highlights }}
                    <ul class="highlights">
                        {{ range .highlights }}
                        <li>{{ . | markdownify }}</li>
                        {{ end }}
                    </ul>
                    {{ end }}
                </article>
                {{ end }} {{ end }}
            </section>
        </div>
        {{ end }}

        <!-- Formation -->
        {{ if .education }}
        <div class="row">
            <section class="resume-section education">
                <h2>Formation</h2>
                {{ range .education }}
                <article class="institution">
                    <header class="institution__header">
                        <h3 class="institution__name">{{ .institution }}</h3>
                        <div class="institution__certificate">
                            {{ .studyType }} {{ if .area }} en {{ .area }} {{
                            end}}
                        </div>
                        <time class="date">
                            {{ .startDate | dateFormat "2006" }} ‚Äì {{ .endDate |
                            dateFormat "2006" }}
                        </time>
                    </header>
                </article>
                {{ end }}
            </section>
        </div>
        {{ end }}

        <!-- Comp√©tences -->
        {{ if .skills }}
        <div class="row">
            <section class="resume-section skills">
                <h2>Comp√©tences</h2>
                <div class="skills-container">
                    <div class="skills-grid">
                        {{ range .skills }} {{ if .name }}
                        <span class="skill-tag" title="{{ .name }}"
                            >{{ .name }}</span
                        >
                        {{ end }} {{ end }}
                    </div>
                </div>
            </section>
        </div>
        {{ end }}

        <!-- Projets -->
        {{ if .projects }}
        <div class="row">
            <section class="resume-section">
                <h2>Projets</h2>
                {{ range .projects }}
                <article class="project-item">
                    <header>
                        <h4>{{ .name }}</h4>
                        {{ if .startDate }}
                        <time class="date">
                            {{ .startDate | dateFormat "2006" }}{{ if .endDate
                            }} - {{ .endDate | dateFormat "2006" }}{{ end }}
                        </time>
                        {{ end }}
                    </header>
                    {{ if .summary }}
                    <p class="project-description">
                        {{ .summary | markdownify }}
                    </p>
                    {{ end }} {{ if .url }}
                    <footer>
                        <a
                            href="{{ .url }}"
                            target="_blank"
                            rel="noopener"
                            class="project-link"
                        >
                            üîó Voir le projet
                        </a>
                    </footer>
                    {{ end }}
                </article>
                {{ end }}
            </section>
        </div>
        {{ end }}

        {{ end }}

        <!-- Action buttons -->
        <div class="row">
            <div class="resume-actions">
                <button onclick="window.print()" class="btn btn-primary">
                    üñ®Ô∏è Imprimer le CV
                </button>
                <a href="/resume.pdf" class="btn btn-secondary" target="_blank">
                    üìÑ Version PDF
                </a>
            </div>
        </div>
    </div>
</main>

<style>
    .summary-truncated {
        display: -webkit-box;
        -webkit-line-clamp: 3;
        -webkit-box-orient: vertical;
        overflow: hidden;
        line-height: 1.4;
    }

    .btn-toggle-summary {
        background: none;
        border: none;
        color: #007bff;
        cursor: pointer;
        font-size: 0.9em;
        margin-top: 0.5em;
        padding: 0;
        text-decoration: underline;
    }

    .btn-toggle-summary:hover {
        color: #0056b3;
    }
</style>

<script>
    function toggleSummary(button) {
        const container = button.parentElement;
        const truncated = container.querySelector(".summary-truncated");
        const full = container.querySelector(".summary-full");

        if (truncated.style.display === "none") {
            // Montrer la version tronqu√©e
            truncated.style.display = "-webkit-box";
            full.style.display = "none";
            button.textContent = "Voir plus";
        } else {
            // Montrer la version compl√®te
            truncated.style.display = "none";
            full.style.display = "block";
            button.textContent = "Voir moins";
        }
    }

    function calculateDuration(startDate, endDate) {
        const start = new Date(startDate);
        const end = endDate ? new Date(endDate) : new Date();

        let years = end.getFullYear() - start.getFullYear();
        let months = end.getMonth() - start.getMonth();

        if (months < 0) {
            years--;
            months += 12;
        }

        let duration = "";
        if (years > 0) {
            duration += years === 1 ? "1 an" : `${years} ans`;
            if (months > 0) {
                duration += " ";
            }
        }
        if (months > 0) {
            duration += months === 1 ? "1 mois" : `${months} mois`;
        }

        return duration ? ` ¬∑ ${duration}` : "";
    }

    // Calculate durations on page load
    document.addEventListener("DOMContentLoaded", function () {
        const timeElements = document.querySelectorAll("time.date[data-start]");
        timeElements.forEach(function (timeElement) {
            const startDate = timeElement.getAttribute("data-start");
            const endDate = timeElement.getAttribute("data-end");
            const durationSpan = timeElement.querySelector(".duration");

            if (startDate && durationSpan) {
                const duration = calculateDuration(startDate, endDate);
                durationSpan.textContent = duration;
            }
        });
    });
</script>

{{ end }}
