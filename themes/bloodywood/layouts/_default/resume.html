{{ define "main" }}
<main role="main">
    <div class="container">
        <!-- Breadcrumb and Print Button -->
        <div class="breadcrumb-container">
            <nav class="breadcrumb" aria-label="Breadcrumb">
                {{ $resumesData := index .Site.Data.resumes "resumes" }} {{
                $currentType := "" }} {{ $currentLang := "" }} {{ if in
                .RelPermalink "/developer/" }} {{ $currentType = "developer" }} {{
                else if in .RelPermalink "/manager/" }} {{ $currentType = "manager"
                }} {{ end }} {{ if in .RelPermalink "/fr" }} {{ $currentLang = "fr"
                }} {{ else if in .RelPermalink "/en" }} {{ $currentLang = "en" }} {{
                end }} {{ range $resumesData }} {{ if eq .type $currentType }} {{
                $versionTitle := "" }} {{ if eq
                $currentLang "fr" }} {{ $versionTitle = .fr.title }} {{ else if eq
                $currentLang "en" }} {{ $versionTitle = .en.title }} {{ end }}

                <span class="breadcrumb-text"
                    ><a href="/resumes/" class="breadcrumb-link">curriculum vit√¶</a>
                    / {{ .type }} ‚Äì {{ $versionTitle }}</span
                ></span>
                {{ end }} {{ end }}
            </nav>

            <button onclick="window.print()" class="btn btn-primary" title="Imprimer le CV">
                üñ®Ô∏è Imprimer le CV
            </button>
        </div>
        {{ $resume := resources.Get .Params.resume_file | transform.Unmarshal }}
        {{ with $resume }} {{ with .basics }}

        <h1>{{ .label }}</h1>
        <!-- En-t√™te avec informations personnelles -->
        <!-- <div class="row">
            <header class="resume-header">
                <h1 data-pagefind-meta="title">{{ .name }}</h1>
                {{ if .label }}
                <h2>{{ .label }}</h2>
                {{ end }} {{ if .summary }}
                <p class="summary">{{ .summary }}</p>
                {{ end }}

                <div class="contact-info">
                    {{ if .email }}
                    <p><a href="mailto:{{ .email }}">{{ .email }}</a></p>
                    {{ end }} {{ if .url }}
                    <p>
                        <a href="{{ .url }}" target="_blank" rel="noopener"
                            >{{ .url }}</a
                        >
                    </p>
                    {{ end }} {{ with .location }} {{ if .address }}
                    <p>{{ .address }}</p>
                    {{ end }} {{ end }}
                </div>

                {{ if .profiles }}
                <div class="social-profiles">
                    {{ range .profiles }}
                    <a
                        href="{{ .url }}"
                        target="_blank"
                        rel="noopener"
                        title="{{ .network }}"
                    >
                        {{ if eq .network "LinkedIn" }}LI{{ end }} {{ if eq
                        .network "Twitter" }}TW{{ end }} {{ if eq .network
                        "Bluesky" }}BS{{ end }} {{ if eq .network "GitHub"
                        }}GH{{ end }}
                    </a>
                    {{ end }}
                </div>
                {{ end }}
            </header>
        </div> -->
        {{ end }}

        <!-- Pr√©sentation -->
        {{ if .basics.summary }}
        <div class="row">
            <section class="resume-section presentation">
                <div class="presentation-content">
                    {{ .basics.summary | markdownify }}
                </div>
            </section>
        </div>
        {{ end }}

        <!-- Profils -->
        {{ if .basics.profiles }}
        <div class="row">
            <section class="resume-section profiles">
                <h2>Profils</h2>
                <div class="profiles-container">
                    {{ range .basics.profiles }}
                    <div class="profile">
                        {{ if .url }}
                        <a
                            href="{{ .url }}"
                            target="_blank"
                            rel="noopener"
                            class="profile-link"
                        >
                            <span class="profile-network">{{ .network }}</span>
                        </a>
                        {{ else }}
                        <div class="profile-link">
                            <span class="profile-network">{{ .network }}</span>
                        </div>
                        {{ end }}
                    </div>
                    {{ end }}
                </div>
            </section>
        </div>
        {{ end }}

        <!-- Exp√©rience professionnelle -->
        {{ if .work }}
        <div class="row">
            <section class="resume-section experiences">
                <h2>Exp√©rience</h2>
                {{ range .work }} {{ if .name }}
                <article class="experience">
                    <header class="experience__header">
                        <h3 class="experience__title">
                            <span class="experience__position"
                                >{{ .position }}</span
                            >
                            ¬∑ {{ if .url }}
                            <a
                                href="{{ .url }}"
                                target="_blank"
                                rel="noopener"
                                class="experience__company"
                                >{{ .name }}</a
                            >
                            {{ else }}
                            <span class="experience__company">{{ .name }}</span>
                            {{ end }}
                        </h3>
                        <div class="experience__meta">
                            <div>
                                <time
                                    class="date"
                                    data-start="{{ .startDate }}"
                                    data-end="{{ .endDate }}"
                                >
                                    {{ .startDate | dateFormat "January 2006" }}
                                    ‚Äì {{ if .endDate }}{{ .endDate | dateFormat
                                    "January 2006" }}{{ else }}Pr√©sent{{ end }}
                                    <span class="duration"></span>
                                </time>
                            </div>

                            {{ if .location }}
                            <div class="experience__location">
                                {{ .location }}
                            </div>
                            {{ end }}
                        </div>
                    </header>

                    {{ if .summary }}
                    <div class="summary-container">
                        <div class="summary">{{ .summary | markdownify }}</div>
                    </div>
                    {{ end }}

                    {{ if .highlights }}
                    <a href="#" class="experience__toggle-link" aria-expanded="false">
                        <span class="toggle-content">‚ñ∏ Voir les r√©alisations marquantes</span>
                    </a>
                    {{ end }}

                    {{ if .highlights }}
                    <div class="experience__highlights">
                        <h4>R√©alisations marquantes :</h4>
                        <ul class="highlights">
                            {{ range .highlights }}
                            <li>{{ . | markdownify }}</li>
                            {{ end }}
                        </ul>
                    </div>
                    {{ end }}
                    {{ if index . "x-keywords" }}
                    <div class="experience__keywords">
                        {{ range index . "x-keywords" }}
                        <span class="keyword-tag">{{ . }}</span>
                        {{ end }}
                    </div>
                    {{ end }}

                </article>
                {{ end }} {{ end }}
            </section>
        </div>
        {{ end }}

        <!-- Formation et certifications -->
        {{ if or .education .certificates }}
        <div class="row">
            <section class="resume-section education">
                <h2>Formation et certifications</h2>

                <!-- Certificats -->
                {{ if .certificates }}
                {{ range .certificates }}
                <article class="institution">
                    <header class="institution__header">
                        <h4 class="institution__name">{{ .name }}</h4>
                        <div class="institution__certificate">
                            {{ if .issuer }}{{ .issuer }}{{ end }}
                        </div>
                        <time class="date">
                            {{ .date | dateFormat "2006" }}
                        </time>
                    </header>
                </article>
                {{ end }}
                {{ end }}

                <!-- Formation -->
                {{ if .education }}
                {{ range .education }}
                <article class="institution">
                    <header class="institution__header">
                        <h4 class="institution__name">{{ .institution }}</h4>
                        <div class="institution__certificate">
                            {{ .studyType }}{{ if .area }}, {{ .area }} {{
                            end}}
                        </div>
                        <time class="date">
                            {{ .startDate | dateFormat "2006" }} ‚Äì {{ .endDate |
                            dateFormat "2006" }}
                        </time>
                    </header>
                </article>
                {{ end }}
                {{ end }}
            </section>
        </div>
        {{ end }}

        <!-- Comp√©tences -->
        {{ if .skills }}
        <div class="row">
            <section class="resume-section skills">
                <h2>Comp√©tences</h2>
                <div class="skills-container">
                    <div class="skills-groups-list">
                        {{ range $groupIndex, $skillGroup := .skills }}
                        <div class="skill-group">
                            <h4 class="skill-group-title">{{ $skillGroup.name }}</h4>
                            {{ if $skillGroup.keywords }}
                            <div class="skill-keywords">
                                {{ range $skillGroup.keywords }}
                                <span class="skill-tag group-{{ $groupIndex }}" title="{{ . }}">{{ . }}</span>
                                {{ end }}
                            </div>
                            {{ end }}
                        </div>
                        {{ end }}
                    </div>
                </div>
            </section>
        </div>
        {{ end }}

        <!-- R√©f√©rences -->
        {{ if .references }}
        <div class="row">
            <section class="resume-section references">
                <h2>R√©f√©rences</h2>
                {{ range .references }}
                <article class="reference">
                    <div class="reference__content">
                        <h4 class="reference__name">{{ .name }}</h4>
                        <blockquote class="reference__quote">
                            "{{ .reference }}"
                        </blockquote>
                    </div>
                </article>
                {{ end }}
            </section>
        </div>
        {{ end }}

        <!-- Centres d'int√©r√™ts -->
        {{ if .interests }}
        <div class="row">
            <section class="resume-section interests">
                <h2>Centres d'int√©r√™ts</h2>
                <div class="interests-simple">
                    {{ range .interests }}
                    <div class="interest-line">
                        <strong>{{ .name }} :</strong> {{ delimit .keywords ", " }}
                    </div>
                    {{ end }}
                </div>
            </section>
        </div>
        {{ end }}

        {{ end }}

        <!-- Action buttons -->
        <div class="row">
            <div class="resume-actions">
                <button onclick="window.print()" class="btn btn-primary">
                    üñ®Ô∏è Imprimer le CV
                </button>
            </div>
        </div>
    </div>
</main>

<script>
    function calculateDuration(startDate, endDate) {
        const start = new Date(startDate);
        const end = endDate ? new Date(endDate) : new Date();

        let years = end.getFullYear() - start.getFullYear();
        let months = end.getMonth() - start.getMonth();

        if (months < 0) {
            years--;
            months += 12;
        }

        let duration = "";
        if (years > 0) {
            duration += years === 1 ? "1 an" : `${years} ans`;
            if (months > 0) {
                duration += " ";
            }
        }
        if (months > 0) {
            duration += months === 1 ? "1 mois" : `${months} mois`;
        }

        return duration ? ` ¬∑ ${duration}` : "";
    }

    // Calculate durations on page load
    document.addEventListener("DOMContentLoaded", function () {
        const timeElements = document.querySelectorAll("time.date[data-start]");
        timeElements.forEach(function (timeElement) {
            const startDate = timeElement.getAttribute("data-start");
            const endDate = timeElement.getAttribute("data-end");
            const durationSpan = timeElement.querySelector(".duration");

            if (startDate && durationSpan) {
                const duration = calculateDuration(startDate, endDate);
                durationSpan.textContent = duration;
            }
        });

        // Handle experience toggle links
        const toggleLinks = document.querySelectorAll(".experience__toggle-link");
        toggleLinks.forEach(function (link) {
            link.addEventListener("click", function (event) {
                event.preventDefault();
                const experience = link.closest(".experience");
                const highlights = experience.querySelector(".experience__highlights");
                const toggleContent = link.querySelector(".toggle-content");
                const isExpanded = link.getAttribute("aria-expanded") === "true";

                if (isExpanded) {
                    highlights.classList.remove("expanded");
                    link.setAttribute("aria-expanded", "false");
                    toggleContent.textContent = "‚ñ∏ Voir les r√©alisations marquantes";
                } else {
                    highlights.classList.add("expanded");
                    link.setAttribute("aria-expanded", "true");
                    toggleContent.textContent = "‚ñæ Cacher les r√©alisations marquantes";
                }
            });
        });
    });
</script>

{{ end }}
